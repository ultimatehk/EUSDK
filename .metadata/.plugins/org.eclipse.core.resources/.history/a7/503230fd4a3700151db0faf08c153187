package cn.eugames.extension.utils;

import java.io.BufferedWriter;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStreamWriter;

import org.json.JSONObject;

import android.content.Context;
import android.text.TextUtils;
import cn.gyyx.extension.common.GyyxConfigParameters;

public class ConfigUtils {

	public static GyyxConfigParameters refineConfigMsg(Context context) {

		GyyxConfigParameters config = null;
		try {
			int id = context.getResources().getIdentifier("config", "raw",
					context.getPackageName());
			InputStream inStream = context.getResources().openRawResource(id);
			byte[] msgBytes = readInputStreamToByte(inStream);
			// String data = CyptoUtils.decode("gyyxgyyx", new String(msgBytes,
			// "UTF-8"));
			// Log.i("----->", data);
			String data = StringUtils.decrypt(new String(msgBytes, "UTF-8"),
					"gyyxgyyx");
			Log.i(Log.LOG_SDK, data);

			JSONObject json = new JSONObject(data);
			config = new GyyxConfigParameters();
			config.setAppId(json.getString("appId"));
			config.setAppKey(json.getString("appKey"));
			config.setGameName(json.getString("gameName"));
			config.setOriention(json.getString("oriention"));
			config.setPlatformName(json.getString("platformName"));
			config.setPlatformIdMd5(json.getString("platformIdMd5"));
			config.setExtendId(json.getString("extendId"));
			config.setClientId(json.getString("clientId"));
			config.setClientKey(json.getString("clientKey"));
			config.setMethodList(json.getString("actionList"));
			config.setManuFactoryId(json.getString("storeFlag"));
			config.setGameFlag(json.getString("gameFlag"));
			config.setServerFlag(json.getString("serverFlag"));

			if (TextUtils.isEmpty(json.getString("extendId"))) {
				config.setExtendId("0");
			}
			if (!json.isNull("authCode")) {
				config.setAuthCode(json.getString("authCode"));
			}

			return config;
		} catch (Exception e) {

		}

		return config;
	}

	private static void writeToFile(File file, String json) {
		try {
			FileOutputStream outStream = new FileOutputStream(file);
			BufferedWriter bufferedWriter = new BufferedWriter(
					new OutputStreamWriter(outStream));
			bufferedWriter.write(json);
			bufferedWriter.flush();
			bufferedWriter.close();
			outStream.close();
		} catch (FileNotFoundException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// private static String generateJson() {
	//
	// JSONObject json = new JSONObject();
	// try {
	// json.put("appId", "EDJ4123fgYXLM");
	// json.put("appKey", "9687557f9c5f446397d6b7360bfb2aaa");
	// json.put("chanel", "guangyu");
	// json.put("gameName", "wendao");
	// json.put("gameCategory", "");
	// json.put("oriention", "landscape");
	// json.put("jyCheckStatus", "");
	// json.put("serverFlag", "xianjianqiyuan");
	// json.put("exchangeRatio", "");
	// json.put("platformId", "");
	//
	// return json.toString();
	// } catch (JSONException e) {
	// e.printStackTrace();
	// }
	// return null;
	// }

	public static byte[] readInputStreamToByte(InputStream in)
			throws IOException {
		int length = 0;
		byte buffer[] = new byte[1024];
		ByteArrayOutputStream out = new ByteArrayOutputStream();
		while ((length = in.read(buffer)) != -1) {
			out.write(buffer, 0, length);
		}

		return out.toByteArray();
	}

}
